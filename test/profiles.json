{
  "Tests": [
    {
      "Convey": "Initial call to getProfileSpecs produces vault profile array",
      "Zome": "profiles",
      "FnName": "getProfiles",
      "Input": {},
      "Output": [{"expiry":0,"fields":[{"description":"How other users will see you","displayName":"Handle","name":"handle","required":true,"schema":{"maxLength":15,"minLength":3,"type":"string"},"usage":"store"}],"hash":"QmdgHsdD81wBwXVJKzWDMdGhNuX7VAoV8bwSaUaaHATtVc","name":"holo-chat","sourceDNA":"QmVECbKJnYSuCRkq1atmGMBiit1CVXYiW7VDGb89CDnDHx"}]
    },
    {
      "Convey": "Calling register with an invalid profileSpec causes an error",
      "Zome": "profiles",
      "FnName": "registerApp",
      "Input": {},
      "RegExp": "Validation Failed"
    },
    {
      "Convey": "Can register an app with a valid profileSpec",
      "Zome": "profiles",
      "FnName": "registerApp",
      "Input": {
        "sourceDNA": "abc",
        "name": "test",
        "fields": [
          {
            "name": "firstName",
            "displayName": "First Name",
            "required": true,
            "description": "Displayed to all users of the app",
            "usage": "store",
            "schema": {}
          },
          {
            "name": "email",
            "displayName": "Email Address",
            "required": true,
            "description": "Displayed to all users of the app",
            "usage": "store",
            "schema": {}
          }
        ]
      },
      "Output": true
    },
    {
      "Convey": "Can retrieve spec from getProfiles",
      "Zome": "profiles",
      "FnName": "getProfiles",
      "Input": {},
      "Output": [{"expiry":0,"fields":[{"description":"Displayed to all users of the app","displayName":"First Name","name":"firstName","required":true,"schema":{},"usage":"store"},{"description":"Displayed to all users of the app","displayName":"Email Address","name":"email","required":true,"schema":{},"usage":"store"}],"hash":"Qmd4rtYYbTDC6y4nXsDXHYDeFj4KSYw8fFwPbG2j8T2mEp","name":"test","sourceDNA":"abc"},{"expiry":0,"fields":[{"description":"How other users will see you","displayName":"Handle","name":"handle","required":true,"schema":{"maxLength":15,"minLength":3,"type":"string"},"usage":"store"}],"hash":"QmdgHsdD81wBwXVJKzWDMdGhNuX7VAoV8bwSaUaaHATtVc","name":"holo-chat","sourceDNA":"QmVECbKJnYSuCRkq1atmGMBiit1CVXYiW7VDGb89CDnDHx"}]

    },
    {
      "Convey": "Can create a mapping to a non-existent persona",
      "Zome": "profiles",
      "FnName": "createMapping",
      "Input": {
        "retrieverDNA": "abc",
        "profileFieldName": "email",
        "personaHash": "aaa",
        "personaFieldName": "email"
      },
      "Output": 1
    },
    {
      "Convey": "Trying to retrieve this will throw an error",
      "Zome": "profiles",
      "FnName": "retrieve",
      "Input": {
        "retrieverDNA": "abc",
        "profileField": "email"
      },
      "Output": {"message":"No valid mapping found","name":"Error"}
    },
    {
      "Convey": "Create a persona to meet the spec",
      "Zome": "personas",
      "FnName": "createPersona",
      "Input": {"name": "testPersona", "id": "xyz"},
      "Output": "%h1%"
    },
    {
      "Convey": "Can add a field to the persona that meets the spec",
      "Zome": "personas",
      "FnName": "addField",
      "Input": {"personaHash" : "%h1%", "field": {"name" : "firstname", "data": "Willem"}},
      "Output": true
    },
    {
      "Convey": "Can create a mapping to a the new persona",
      "Zome": "profiles",
      "FnName": "createMapping",
      "Input": {
        "retrieverDNA": "abc",
        "profileFieldName": "firstName",
        "personaHash": "%r2%",
        "personaFieldName": "firstname"
      },
      "Output": 1
    },
    {
      "Convey": "This value can be retrieved through vault",
      "Zome": "profiles",
      "FnName": "retrieve",
      "Input": {
        "retrieverDNA": "abc",
        "profileField": "firstName"
      },
      "Output": "Willem"
    },
    {
      "Convey": "Delete the field from the persona (revoke)",
      "Zome": "personas",
      "FnName": "deleteField",
      "Input": {"personaHash": "%h5%", "fieldName": "firstname"},
      "Output": 1
    },
    {
      "Convey": "Trying to retrieve this deleted field will throw an error",
      "Zome": "profiles",
      "FnName": "retrieve",
      "Input": {
        "appDNA": "abc",
        "profileField": "firstName"
      },
      "Output": {"message":"No valid mapping found","name":"Error"}
    }
  ]
}
