FROM holochain/holochain-rust:latest

RUN git clone https://github.com/holochain/holochain-rust && cd holochain-rust && git checkout 15b1892e8544db241e188d2918688ecbc533a45f

WORKDIR /holochain/holochain-rust
ENV PATH /root/.cargo/bin:$PATH

RUN make install_cmd

RUN rustup install nightly
RUN rustup default nightly
RUN rustup target add wasm32-unknown-unknown --toolchain nightly
RUN cd container && cargo install --force --path .

RUN cd nodejs_container && npm install && npm run compile && mkdir -p bin-package && cp native/index.node bin-package && npm link
